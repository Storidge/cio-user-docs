<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Volumes for Services</title>
    <meta name="description" content="User documentation for Storidge CIO software">
    
    
    <link rel="preload" href="/assets/css/0.styles.34c260e6.css" as="style"><link rel="preload" href="/assets/js/app.e05b9c7f.js" as="script"><link rel="preload" href="/assets/js/39.ca2d0ec3.js" as="script"><link rel="prefetch" href="/assets/js/10.82c0bb7a.js"><link rel="prefetch" href="/assets/js/11.f60b7486.js"><link rel="prefetch" href="/assets/js/12.92564031.js"><link rel="prefetch" href="/assets/js/13.94cac131.js"><link rel="prefetch" href="/assets/js/14.126fd42e.js"><link rel="prefetch" href="/assets/js/15.cd9215ed.js"><link rel="prefetch" href="/assets/js/16.f3160673.js"><link rel="prefetch" href="/assets/js/17.bac0da4d.js"><link rel="prefetch" href="/assets/js/18.cfe5f0e7.js"><link rel="prefetch" href="/assets/js/19.a580bafd.js"><link rel="prefetch" href="/assets/js/2.a74784fd.js"><link rel="prefetch" href="/assets/js/20.bdfdc673.js"><link rel="prefetch" href="/assets/js/21.2de97583.js"><link rel="prefetch" href="/assets/js/22.7069a8b6.js"><link rel="prefetch" href="/assets/js/23.7aea708e.js"><link rel="prefetch" href="/assets/js/24.5ec3c2d0.js"><link rel="prefetch" href="/assets/js/25.2e88b90c.js"><link rel="prefetch" href="/assets/js/26.8b871e95.js"><link rel="prefetch" href="/assets/js/27.7bda0b9c.js"><link rel="prefetch" href="/assets/js/28.1456a03c.js"><link rel="prefetch" href="/assets/js/29.e78a0e6b.js"><link rel="prefetch" href="/assets/js/3.652aaa99.js"><link rel="prefetch" href="/assets/js/30.6ac6d22e.js"><link rel="prefetch" href="/assets/js/31.f465c10a.js"><link rel="prefetch" href="/assets/js/32.c650f2c9.js"><link rel="prefetch" href="/assets/js/33.a8705f17.js"><link rel="prefetch" href="/assets/js/34.7a5e2be1.js"><link rel="prefetch" href="/assets/js/35.e4979297.js"><link rel="prefetch" href="/assets/js/36.a088f027.js"><link rel="prefetch" href="/assets/js/37.39d44fed.js"><link rel="prefetch" href="/assets/js/38.c1753ec3.js"><link rel="prefetch" href="/assets/js/4.a5dbc094.js"><link rel="prefetch" href="/assets/js/40.e9a5ef27.js"><link rel="prefetch" href="/assets/js/41.be51cf9f.js"><link rel="prefetch" href="/assets/js/42.042b7ec2.js"><link rel="prefetch" href="/assets/js/43.61eb9721.js"><link rel="prefetch" href="/assets/js/44.846f8bec.js"><link rel="prefetch" href="/assets/js/45.0cbe395a.js"><link rel="prefetch" href="/assets/js/46.7ab0865a.js"><link rel="prefetch" href="/assets/js/47.9840030e.js"><link rel="prefetch" href="/assets/js/48.da121484.js"><link rel="prefetch" href="/assets/js/49.0dee9f7b.js"><link rel="prefetch" href="/assets/js/5.e2683d3f.js"><link rel="prefetch" href="/assets/js/50.d02e44d8.js"><link rel="prefetch" href="/assets/js/51.9dad44d4.js"><link rel="prefetch" href="/assets/js/52.e69701c3.js"><link rel="prefetch" href="/assets/js/6.c2ad22f6.js"><link rel="prefetch" href="/assets/js/7.e3242b4d.js"><link rel="prefetch" href="/assets/js/8.cc24321b.js"><link rel="prefetch" href="/assets/js/9.276401ad.js">
    <link rel="stylesheet" href="/assets/css/0.styles.34c260e6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://storidge.com/wp-content/uploads/2017/06/logowc2d.png" alt="" class="logo"> <!----></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://storidge.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://storidge.com/api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  API
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/storidge" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://storidge.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://storidge.com/api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  API
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/storidge" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Get Started</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Docker Volumes</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/docker_volumes/volumes.html" class="sidebar-link">Volumes</a></li><li><a href="/docker_volumes/volumes_for_containers.html" class="sidebar-link">Volumes for Containers</a></li><li><a href="/docker_volumes/volumes_for_services.html" class="active sidebar-link">Volumes for Services</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docker_volumes/volumes_for_docker_compose.html" class="sidebar-link">Volumes for Docker Compose</a></li><li><a href="/docker_volumes/volumes_and_dockerfiles.html" class="sidebar-link">Volumes and Dockerfiles</a></li><li><a href="/docker_volumes/upgrade_cio_volume_plugin.html" class="sidebar-link">Upgrade CIO Volume Plugin</a></li><li><a href="/docker_volumes/about_volume_plugins.html" class="sidebar-link">About Volume Plugins</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Kubernetes Storage</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Profiles</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Cluster</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Cookbook</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Cloud Reference Guide</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>cio commands</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>cioctl commands</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Release Notes</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="volumes-for-services"><a href="#volumes-for-services" aria-hidden="true" class="header-anchor">#</a> Volumes for Services</h1> <p><a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener noreferrer">Docker Swarm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is the cluster management component embedded in the Docker Engine. A swarm cluster consists of multiple hosts which run as manager or worker nodes. Containers run as a service within a swarm cluster and it is the role of the manager to maintain the desired state of the service. When a service is created the desired state can be defined in terms of the number of replicas, ports the service exposes, and network or storage resources allocated to the service.</p> <p>CIO provides a data management platform for a swarm cluster so persistent storage can be programmatically provisioned and managed for stateful applications.</p> <p>When a service is rescheduled by docker to a different node, the CIO volume plugin moves the volume to the new node where the service is restarting. More importantly when a node fails and Docker Swarm restarts services on new nodes, the CIO storage orchestrator fails over the correct volumes to keep the stateful services running. This greatly simplifies the operational burden of ensuring high availability for stateful services and applications.</p> <h4 id="create"><a href="#create" aria-hidden="true" class="header-anchor">#</a> <strong>Create</strong></h4> <p>To <a href="https://docs.docker.com/engine/reference/commandline/service_create/" target="_blank" rel="noopener noreferrer">start a service<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> you use the <code>docker service create</code> command. A persistent volume for the service can be specified by using the <code>--mount</code> flag. If the volume does not already exist, Docker creates the volume.</p> <p><strong>Note:</strong>  that the <code>docker service create</code> command does not support the <code>-v</code> or <code>--volume</code> flag. To mount a volume into a service's container, you must use the <code>--mount</code> flag.</p> <p>You specify a CIO volume in a <code>docker service create</code> command by using the <code>volume-driver</code> option to call the cio driver and the <code>volume-opt</code> option to set volume options. For example</p> <div class="language- extra-class"><pre class="language-text"><code>docker service create \
--mount source=mysql-data,target=/var/lib/mysql,volume-driver=cio,volume-opt=profile=MYSQL \
--replicas 1 \
--detach=false \
-e MYSQL_ROOT_PASSWORD=mysecret \
--name mysql \
mysql
</code></pre></div><p>This creates a volume named mysql-data with volume options set in <a href="http://storidge.com/docs/profiles/" target="_blank" rel="noopener noreferrer">profile<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> MYSQL for a MySQL database running as a service. The replicas value is set to 1 as schedulers do not have a naming convention for scaling persistent volumes with services.</p> <p>While the example above uses a profile to set multiple volume options, volume options can also be individually set. Use comma separated key-value pairs to set multiple volume options.</p> <p>The following options are supported by the CIO volume plugin:</p> <table><thead><tr><th><strong>option</strong></th> <th><strong>description</strong></th> <th>value</th> <th>example</th></tr></thead> <tbody><tr><td>capacity</td> <td>Size in GB</td> <td>1 to 64000</td> <td>capacity=25</td></tr> <tr><td>directory</td> <td>Host path to bind mount</td> <td>/path/to/volume</td> <td>directory=/cio</td></tr> <tr><td>level</td> <td>Level of data redundancy</td> <td>1, 2, 3</td> <td>level=2</td></tr> <tr><td>type</td> <td>Type of backend storage</td> <td>ssd, hdd</td> <td>type=ssd</td></tr> <tr><td>iops</td> <td>Performance in min/max IOPS</td> <td>30 min, 1000000 max</td> <td>iops=100,5000</td></tr> <tr><td>bandwidth</td> <td>Performance in min/max MB/s</td> <td>1 min, 1000 max</td> <td>bandwidth=10,50</td></tr> <tr><td>provision</td> <td>Thick or thin provisioning</td> <td>thin, thick</td> <td>provision=thick</td></tr> <tr><td>profile</td> <td>Template for volume creation</td> <td>profile name</td> <td>profile=MYSQL</td></tr></tbody></table> <h4 id="inspect"><a href="#inspect" aria-hidden="true" class="header-anchor">#</a> <strong>Inspect</strong></h4> <p>Use <code>docker service inspect mysql</code> to verify that the volume above was created and mounted correctly. Look for the <code>Mounts</code> section.</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;Mounts&quot;: [
    {
        &quot;Type&quot;: &quot;volume&quot;,
        &quot;Source&quot;: &quot;mysql-data&quot;,
        &quot;Target&quot;: &quot;/var/lib/mysql&quot;,
        &quot;VolumeOptions&quot;: {
            &quot;DriverConfig&quot;: {
                &quot;Name&quot;: &quot;cio&quot;,
                &quot;Options&quot;: {
                    &quot;profile&quot;: &quot;MYSQL&quot;
                }
            }
        }
    }
],
</code></pre></div><p>This shows that the mount is a volume, with the source (volume name mysql-data) mounted in the container at directory /var/lib/mysql. The driver configuration section shows that profile MYSQL was used to set the volume options.</p> <h4 id="remove"><a href="#remove" aria-hidden="true" class="header-anchor">#</a> <strong>Remove</strong></h4> <p>To remove the volume, first remove the service.</p> <div class="language- extra-class"><pre class="language-text"><code>$ docker service rm mysql

$ docker volume rm mysql
</code></pre></div><h3 id="docker-volume-create"><a href="#docker-volume-create" aria-hidden="true" class="header-anchor">#</a> <strong>docker volume create</strong></h3> <p>You can create and manage volumes separate from a service with the <code>docker volume create</code> command. The <code>--driver</code> flag is used to call the cio volume plugin and volume options are passed to the driver using the <code>-o</code> or <code>--opt</code> flag. For example</p> <div class="language- extra-class"><pre class="language-text"><code>docker volume create --driver cio 
--name mysqldb \
--opt size=50 \
--opt type=ssd \
--opt iops=1000,2000 \
--label version=3.3 --label release=stable
</code></pre></div><p>The volume created as <code>mysqldb</code> can now be passed to the <code>docker service create</code> command in the source field. Example</p> <div class="language- extra-class"><pre class="language-text"><code>docker service create \
--mount source=mysqldb,target=/var/lib/mysql,volume-driver=cio \
--replicas 1 \
-e MYSQL_ROOT_PASSWORD=mysecret \
--name mysql \
mysql
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/5/2019, 2:47:29 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/docker_volumes/volumes_for_containers.html" class="prev">
          Volumes for Containers
        </a></span> <span class="next"><a href="/docker_volumes/volumes_for_docker_compose.html">
          Volumes for Docker Compose
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.e05b9c7f.js" defer></script><script src="/assets/js/39.ca2d0ec3.js" defer></script>
  </body>
</html>
